
<!DOCTYPE html> 
<html>
    <head>
        <title>Tims Series Insights</title>

        <script src="https://unpkg.com/tsiclient@latest/tsiclient.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bluebird/3.3.4/bluebird.min.js"></script>
        <link rel="stylesheet" type="text/css" href="https://unpkg.com/tsiclient@latest/tsiclient.css" />
    </head>
    <body style="font-family: 'Segoe UI', sans-serif;">
        <div id="chart1" style="width: 100%; height: 600px;"></div>
        
        <script>
            window.onload = function() {
                
                var jsonString = '@ViewData["Data"]';
                jsonString = jsonString.replace(/&quot;/g, '\"');
                var data = JSON.parse(jsonString);

                jsonString = '@ViewData["TimeSeriesIds"]';
                jsonString = jsonString.replace(/&quot;/g, '\"');
                var timeSeriesIds = JSON.parse(jsonString);

                var tsiClient = new TsiClient();

                var tsqExpressions = [];
                var colors = ['#0078D7', '#E0349E', '#60B9AE', '#854CC7', '#FFF100', '#258225', '#FF2828'];
                timeSeriesIds.forEach((timeSeriesId, i) => {
                    tsqExpressions.push(
                        new tsiClient.ux.TsqExpression(
                            {timeSeriesId: [timeSeriesId]},
                            {@ViewData["VariableName"]: {
                                kind: '@ViewData["VariableType"]',
                                value: {tsx: '@ViewData["VariableValue"]'},
                                aggregation: {tsx: '@ViewData["VariableAggregation"]'}
                            }},
                            {from: new Date('@ViewData["From"]'), to: new Date('@ViewData["To"]'), bucketSize: '@ViewData["BucketSize"]'},
                            {color: colors[i], alias: timeSeriesId}));
                });

                var transformedData = tsiClient.ux.transformTsqResultsForVisualization(data, tsqExpressions);

                var lineChart = new tsiClient.ux.LineChart(document.getElementById('chart1'));
                var lineChartOptions = {
                    theme: 'dark',
                    legend: 'compact',
                    yAxisState: '@ViewData["yAxisState"]',
                    interpolationFunction: ''
                };
                lineChart.render(transformedData, lineChartOptions, tsqExpressions);
            };
        </script>
    </body>
</html>